{% extends "base.html" %}

{% block title %}NGO Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Left Sidebar: NGO Info -->
        <div class="col-md-3">
            <div class="card bg-gradient-primary text-white mb-4 shadow-lg" style="min-height: 350px; border-radius: 22px; border: 2px solid #fff;">
                <div class="d-flex align-items-center mb-3">
                    <img src="https://img.icons8.com/color/96/000000/charity.png" alt="NGO Symbol" class="me-3" style="width:64px; height:64px; border-radius:50%; background:#fff; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                    <div>
                        <h4 class="mb-0 fw-bold" style="letter-spacing:1px;">Hope &amp; Health Network <span class="badge bg-light text-primary ms-2" style="font-size:0.8em;">NGO</span></h4>
                    </div>
                </div>
                <hr style="border-top: 2px solid #fff;">
                <div class="mb-2">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    <span class="fw-semibold">#23, 4th Cross, Vijayanagar, Bangalore, Karnataka - 560040</span>
                </div>
                <div class="mb-2">
                    <i class="fas fa-envelope me-2"></i>
                    <span class="fw-semibold">ngo@gmail.com</span>
                </div>
                <div class="text-center mt-4">
                    <img src="https://img.icons8.com/fluency/48/000000/medical-doctor.png" alt="NGO Office" style="width:48px;">
                    <p class="mt-2 mb-0" style="font-size:1.1em;">Serving the community with care</p>
                </div>
            </div>
            <!-- Medicine List -->
            <div class="card shadow mb-4" style="border-radius: 18px;">
                <div class="card-header bg-info text-white" style="border-radius: 18px 18px 0 0;">
                    <h5 class="mb-0"><i class="fas fa-pills"></i> Medicine List</h5>
                </div>
                <ul class="list-group list-group-flush">
                    {% set medicine_dict = {
                        'Cancer': ['Tamoxifen', 'Letrozole', 'Imatinib'],
                        'TB': ['Isoniazid', 'Rifampicin', 'Ethambutol'],
                        'AIDS': ['Zidovudine', 'Lamivudine', 'Efavirenz'],
                        'HIV': ['Tenofovir', 'Emtricitabine', 'Dolutegravir']
                    } %}
                    {% for disease, meds in medicine_dict.items() %}
                    <li class="list-group-item d-flex justify-content-between align-items-center medicine-link" style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#medicineModal" data-disease="{{ disease }}" data-meds="{{ meds|join(',') }}">
                        <span><i class="fas fa-virus me-2"></i> {{ disease }}</span>
                        <span class="badge bg-primary">{{ meds|length }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <!-- Main Content -->
        <div class="col-md-9">
            <div class="d-flex justify-content-end mb-3">
                <a href="{{ url_for('logout') }}" class="btn btn-danger btn-lg" style="z-index:1000; position:relative;"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
            </div>
            <!-- Top: Staff Members -->
            <div class="card shadow mb-4 p-3" style="border-radius: 18px;">
                <h5 class="mb-3"><i class="fas fa-user-friends"></i> NGO Staff Members</h5>
                <div class="d-flex flex-wrap gap-3">
                    {% set staff_list = [
                        {'name': 'Amit Kumar', 'area': 'Hubli City', 'img': 'https://randomuser.me/api/portraits/men/11.jpg'},
                        {'name': 'Priya Singh', 'area': 'Dharwad', 'img': 'https://randomuser.me/api/portraits/women/21.jpg'},
                        {'name': 'Rahul Patil', 'area': 'Gokul Road', 'img': 'https://randomuser.me/api/portraits/men/22.jpg'},
                        {'name': 'Sneha Rao', 'area': 'Vidyanagar', 'img': 'https://randomuser.me/api/portraits/women/23.jpg'},
                        {'name': 'Vikas Joshi', 'area': 'Old Hubli', 'img': 'https://randomuser.me/api/portraits/men/24.jpg'}
                    ] %}
                    {% for staff in staff_list %}
                    <div class="card text-center shadow-sm staff-link" style="width: 160px; border-radius: 16px; cursor:pointer;" data-staff='{{ staff|tojson }}'>
                        <img src="{{ staff.img }}" class="rounded-circle mx-auto mt-3" style="width:60px; height:60px;">
                        <div class="card-body p-2">
                            <h6 class="mb-0">{{ staff.name }}</h6>
                            <small class="text-muted">{{ staff.area }}</small>
                            <span class="badge bg-primary d-block mt-2">Staff</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Staff & Patients List -->
            <div class="row" id="staffPatients">
                <!-- Will be filled by JS after staff click -->
            </div>
        </div>
    </div>
</div>
<!-- Patient Details Modal -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="patientModalLabel">Patient Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="patientDetails">
          <!-- Patient details will be loaded here by JS -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Medicine Modal -->
<div class="modal fade" id="medicineModal" tabindex="-1" aria-labelledby="medicineModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="medicineModalLabel">Medicine List</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="medicineList">
        <!-- Medicine list will be loaded here by JS -->
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Staff click: show patients for that staff
const patientNames = [
    'Ravi', 'Sunita', 'Manoj', 'Asha', 'Deepak', 'Kiran', 'Meena', 'Suresh', 'Lata', 'Vijay',
    'Anil', 'Pooja', 'Ramesh', 'Geeta', 'Sanjay', 'Neha', 'Ajay', 'Kavita', 'Arun', 'Shilpa',
    'Nitin', 'Divya', 'Raj', 'Komal', 'Prakash', 'Seema', 'Yogesh', 'Nisha', 'Mahesh', 'Payal'
];
const patientHistory = [
    {month: '2025-06', status: 'Taken'},
    {month: '2025-05', status: 'Taken'},
    {month: '2025-04', status: 'Not Taken'},
    {month: '2025-03', status: 'Taken'}
];
$(document).on('click', '.staff-link', function() {
    var staff = $(this).data('staff');
    let html = '';
    html += `<div class='col-12'><h5 class='mb-3'><i class='fas fa-users'></i> Patients handled by <span class='text-primary'>${staff.name}</span> (${staff.area})</h5></div>`;
    for(let i=0; i<10; i++) {
        let pname = patientNames[Math.floor(Math.random()*patientNames.length)];
        html += `<div class='col-md-6 mb-3'>
            <div class='card shadow patient-link' style='border-radius: 18px; cursor:pointer;' data-bs-toggle='modal' data-bs-target='#patientModal' data-patient='{"name":"${pname}","area":"${staff.area}"}'>
                <div class='card-body d-flex align-items-center'>
                    <i class='fas fa-user fa-2x me-3'></i>
                    <div>
                        <h6 class='mb-0'>${pname}</h6>
                        <small class='text-muted'>${staff.area}</small>
                    </div>
                </div>
            </div>
        </div>`;
    }
    $('#staffPatients').html(html);
});
// Patient click: show details and history
$(document).on('click', '.patient-link', function() {
    var patient = $(this).data('patient');
    var html = `
        <h4><i class="fas fa-user"></i> ${patient.name}</h4>
        <p><strong>Area:</strong> ${patient.area}</p>
        <h6>Monthly Medicine History</h6>
        <ul class='list-group mb-2'>
            ${patientHistory.map(h => `<li class='list-group-item d-flex justify-content-between align-items-center'>${h.month}<span class='badge bg-${h.status==='Taken'?'success':'danger'}'>${h.status}</span></li>`).join('')}
        </ul>
        <p><strong>Monthly Tablet:</strong> <span class="badge bg-${Math.random() > 0.5 ? 'success' : 'danger'}">${Math.random() > 0.5 ? 'Taken' : 'Not Taken'}</span></p>
        <hr>
        <p>More details can be fetched from the hospital database.</p>
    `;
    $('#patientDetails').html(html);
});
// Medicine click: show medicine list
$(document).on('click', '.medicine-link', function() {
    var disease = $(this).data('disease');
    var meds = $(this).data('meds').split(',');
    var html = `<h5>${disease} Medicines</h5><ul class='list-group'>`;
    meds.forEach(med => {
        html += `<li class='list-group-item'><i class='fas fa-capsules me-2'></i> ${med}</li>`;
    });
    html += '</ul>';
    $('#medicineList').html(html);
});
</script>
{% endblock %}
